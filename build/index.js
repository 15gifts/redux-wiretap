"use strict";function _interopDefault(r){return r&&"object"==typeof r&&"default"in r?r.default:r}var _Set=_interopDefault(require("babel-runtime/core-js/set")),_Array$from=_interopDefault(require("babel-runtime/core-js/array/from"));function arrayIncludes(r,n){if(Array.isArray(r))for(var t=0;t<r.length;t+=1)if(r[t]===n)return!0;return!1}function isFunction(r){return"[object Function]"===Object.prototype.toString.call(r)}function isString(r){return"string"==typeof r}var VarsHandler=function(r){var n=r||{};return{getVars:function(){return n},setVars:function(r){return n=r||n}}};function actionMatches(r,n){return Array.isArray(r)?-1<r.indexOf(n):r===n}function createConfig(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return{beforeAnyAction:isFunction(r.beforeAnyAction)&&r.beforeAnyAction,beforeCallback:isFunction(r.beforeCallback)&&r.beforeCallback,callback:isFunction(r.callback)&&r.callback,afterCallback:isFunction(r.afterCallback)&&r.afterCallback,afterAnyAction:isFunction(r.afterAnyAction)&&r.afterAnyAction,points:Array.isArray(r.points)?r.points:[],vars:r.vars&&!isFunction(r.vars)?r.vars:{}}}function createTriggerActionCache(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).reduce(function(r,n){var t=n.triggerAction,e=r;if(Array.isArray(t)){var i=t.filter(function(r){return isString(r)});e=[].concat(r,i)}else isString(t)&&e.push(t);return _Array$from(new _Set(e))},[])}function filterPoints(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=n.action,r=n.config,e=(void 0===r?{}:r).points;return e&&Array.isArray(e)&&0<e.length?e.filter(function(r){return actionMatches(r.triggerAction,t.type)}).map(function(r){return r.logic?r.logic(n):r}).filter(function(r){return!!r}).filter(function(r){return void 0===r.shouldFire||!!r.shouldFire}):[]}function runCallbackFunctions(r,e){var n=r&&Array.isArray(r)&&0<r.length,i=e&&e.config;n&&i&&r.forEach(function(t){["beforeCallback","callback","afterCallback"].forEach(function(r){var n=i&&i[r];n&&n(t.data,e)})})}function middleware(r){var c=createConfig(r),n=c.vars,u=createTriggerActionCache(c.points),f=new VarsHandler(n);return function(o){return function(a){return function(r){function n(){return{action:r,config:c,nextState:i,prevState:t,getVars:f.getVars,setVars:f.setVars}}var t=o.getState(),e=a(r),i=o.getState();return c.beforeAnyAction&&c.beforeAnyAction(n()),arrayIncludes(u,r.type)&&runCallbackFunctions(filterPoints(n()),n()),c.afterAnyAction&&c.afterAnyAction(n()),e}}}}var index=function(r){return middleware(r)};module.exports=index;
